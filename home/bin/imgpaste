#!/bin/zsh

# thanks to simonw for this script: https://til.simonwillison.net/macos/impaste

platform=$(uname)

if [[ ! $platform == "Darwin" ]]; then
    echo "imgpaste only works on mac, bro"
    exit 1
fi;

# Generate a unique temporary filename
tempfile=$(mktemp -t clipboard.XXXXXXXXXX.png)

# Save the clipboard image to the temporary file
osascript -e 'set theImage to the clipboard as «class PNGf»' \
  -e "set theFile to open for access POSIX file \"$tempfile\" with write permission" \
  -e 'write theImage to theFile' \
  -e 'close access theFile'

# Output the image data to stdout
cat "$tempfile"

# Delete the temporary file
rm "$tempfile"
